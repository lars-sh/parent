<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>Iterators.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">Parent POM</a> &gt; <a href="../index.html" class="el_bundle">utils</a> &gt; <a href="index.source.html" class="el_package">de.larssh.utils.collection</a> &gt; <span class="el_source">Iterators.java</span></div><h1>Iterators.java</h1><pre class="source lang-java linenums">// Generated by delombok at Wed Jan 19 02:44:50 UTC 2022
package de.larssh.utils.collection;

import java.util.Iterator;
import java.util.NoSuchElementException;
import java.util.Spliterator;
import java.util.Spliterators;
import java.util.function.Function;
import java.util.stream.Stream;
import java.util.stream.StreamSupport;
import edu.umd.cs.findbugs.annotations.Nullable;

/**
 * This class contains helper methods for {@link Iterator}.
 */
public final class Iterators {
	/**
	 * Wraps {@code elementsSupplier} into a {@link PeekableIterator}. This is
	 * probably the simplest way of writing an iterator.
	 *
	 * &lt;p&gt;
	 * Note: This iterator is &lt;b&gt;not&lt;/b&gt; thread safe.
	 *
	 * &lt;p&gt;
	 * &lt;b&gt;Usage example:&lt;/b&gt; The following shows how to create an iterator returning
	 * every second element only.
	 *
	 * &lt;pre&gt;
	 * Iterator&amp;lt;E&amp;gt; oldIterator = ...;
	 * Iterator&amp;lt;E&amp;gt; newIterator = Iterators.iterator(state -&amp;gt; {
	 *     if (!oldIterator.hasNext() &amp;amp;&amp;amp; !oldIterator.hasNext()) {
	 *         return state.endOfData();
	 *     }
	 *     return oldIterator.next();
	 * });
	 * &lt;/pre&gt;
	 *
	 * @param &lt;E&gt;              the type of the iterator elements
	 * @param elementsSupplier the elements supplier with the state as parameter
	 * @return a {@link PeekableIterator} wrapping {@code elementsSupplier}
	 */
	public static &lt;E&gt; PeekableIterator&lt;E&gt; iterator(final Function&lt;ElementsSupplierStateHandler&lt;E&gt;, E&gt; elementsSupplier) {
<span class="nc" id="L43">		return new ElementsSupplierIterator&lt;&gt;(elementsSupplier);</span>
	}

	/**
	 * Wraps {@code iterator} into a {@link PeekableIterator}.
	 *
	 * &lt;p&gt;
	 * Note: The resulting iterator is &lt;b&gt;not&lt;/b&gt; thread safe.
	 *
	 * @param &lt;E&gt;      the type of the iterator elements
	 * @param iterator the iterator
	 * @return a {@link PeekableIterator} wrapping {@code iterator}
	 */
	public static &lt;E&gt; PeekableIterator&lt;E&gt; peekableIterator(final Iterator&lt;E&gt; iterator) {
<span class="nc bnc" id="L57" title="All 2 branches missed.">		if (iterator instanceof PeekableIterator) {</span>
<span class="nc" id="L58">			return (PeekableIterator&lt;E&gt;) iterator;</span>
		}
<span class="nc bnc" id="L60" title="All 2 branches missed.">		return iterator(state -&gt; iterator.hasNext() ? iterator.next() : state.endOfData());</span>
	}

	/**
	 * Returns a sequential {@link Stream} with the {@code elementsSupplier} as its
	 * source.
	 *
	 * &lt;p&gt;
	 * Check out {@link #iterator(Function)} for more information about
	 * {@code elementsSupplier}.
	 *
	 * @param &lt;E&gt;              the type of the iterator elements
	 * @param elementsSupplier the elements supplier with the state as parameter
	 * @return a {@code Stream} with the elements of {@code elementsSupplier}
	 */
	public static &lt;E&gt; Stream&lt;E&gt; stream(final Function&lt;ElementsSupplierStateHandler&lt;E&gt;, E&gt; elementsSupplier) {
<span class="nc" id="L76">		return stream(iterator(elementsSupplier));</span>
	}

	/**
	 * Returns a sequential {@link Stream} with the {@code iterator} as its source.
	 *
	 * @param &lt;E&gt;      the type of the iterator elements
	 * @param iterator the iterator
	 * @return a {@code Stream} with the elements of {@code iterator}
	 */
	public static &lt;E&gt; Stream&lt;E&gt; stream(final Iterator&lt;E&gt; iterator) {
<span class="nc" id="L87">		return StreamSupport.stream(Spliterators.spliteratorUnknownSize(iterator, Spliterator.ORDERED), false);</span>
	}


	/**
	 * Implementation of a {@link PeekableIterator} based upon an elements supplier.
	 *
	 * &lt;p&gt;
	 * Check out {@link #iterator(Function)} for more information about the elements
	 * supplier.
	 *
	 * @param &lt;E&gt; the type of the iterator elements
	 */
	private static class ElementsSupplierIterator&lt;E&gt; implements PeekableIterator&lt;E&gt; {
		/**
		 * An elements supplier with the state as parameter.
		 *
		 * &lt;p&gt;
		 * Check out {@link #iterator(Function)} for more information.
		 */
		private final Function&lt;ElementsSupplierStateHandler&lt;E&gt;, E&gt; elementsSupplier;
		/**
		 * The next element supplied by {@link #elementsSupplier} if {@link #state} is
		 * {@link ElementsSupplierState#PEEKED}, else undefined.
		 */
		@Nullable
		private E peekedElement = null;
		/**
		 * The iterator's current inner state
		 */
		private ElementsSupplierState state = ElementsSupplierState.CALL_FOR_NEXT;
		/**
		 * Implementation of {@link ElementsSupplierStateHandler} to update this
		 * iterator's current state
		 */
		private final ElementsSupplierStateHandler&lt;E&gt; stateHandler = () -&gt; {
<span class="nc" id="L123">			state = ElementsSupplierState.END_OF_DATA;</span>
<span class="nc" id="L124">			return null;</span>
		};

		/**
		 * {@inheritDoc}
		 */
		@Override
		@SuppressWarnings(&quot;checkstyle:XIllegalCatchDefault&quot;)
		public final boolean hasNext() {
<span class="nc bnc" id="L133" title="All 2 branches missed.">			if (state == ElementsSupplierState.CALL_FOR_NEXT) {</span>
<span class="nc" id="L134">				peekedElement = elementsSupplier.apply(stateHandler);</span>
<span class="nc bnc" id="L135" title="All 2 branches missed.">				if (state == ElementsSupplierState.CALL_FOR_NEXT) {</span>
<span class="nc" id="L136">					state = ElementsSupplierState.PEEKED;</span>
				}
			}
<span class="nc bnc" id="L139" title="All 2 branches missed.">			return state == ElementsSupplierState.PEEKED;</span>
		}

		/**
		 * {@inheritDoc}
		 */
		@Nullable
		@Override
		@SuppressWarnings(&quot;PMD.NullAssignment&quot;)
		public final E next() {
			// Method &quot;hasNext&quot; peeks the next element (if required)
<span class="nc bnc" id="L150" title="All 2 branches missed.">			if (!hasNext()) {</span>
<span class="nc" id="L151">				throw new NoSuchElementException();</span>
			}
<span class="nc" id="L153">			final E next = peekedElement;</span>
<span class="nc bnc" id="L154" title="All 2 branches missed.">			if (state == ElementsSupplierState.PEEKED) {</span>
<span class="nc" id="L155">				state = ElementsSupplierState.CALL_FOR_NEXT;</span>
			}
<span class="nc" id="L157">			peekedElement = null;</span>
<span class="nc" id="L158">			return next;</span>
		}

		/**
		 * {@inheritDoc}
		 */
		@Nullable
		@Override
		public E peek() {
			// Method &quot;hasNext&quot; peeks the next element (if required)
<span class="nc bnc" id="L168" title="All 2 branches missed.">			if (!hasNext()) {</span>
<span class="nc" id="L169">				throw new NoSuchElementException();</span>
			}
<span class="nc" id="L171">			return peekedElement;</span>
		}

		@java.lang.SuppressWarnings(&quot;all&quot;)
		@edu.umd.cs.findbugs.annotations.SuppressFBWarnings(justification = &quot;generated code&quot;)
		@lombok.Generated
		public ElementsSupplierIterator(final Function&lt;ElementsSupplierStateHandler&lt;E&gt;, E&gt; elementsSupplier) {
			this.elementsSupplier = elementsSupplier;
		}
	}


	/**
	 * This enumeration contains the possible inner states of
	 * {@link ElementsSupplierIterator}.
	 */
<span class="nc" id="L187">	@SuppressWarnings(&quot;PMD.UnnecessaryModifier&quot;)</span>
	private static enum ElementsSupplierState {
		/**
		 * Status of iterators, that need to call the elements supplier once information
		 * about the next element is required.
		 */
<span class="nc" id="L193">		CALL_FOR_NEXT, /**</span>
		 * Status representing the end of data. The elements supplier must not be called
		 * any longer. This is an end state and must not change once reached.
		 */
<span class="nc" id="L197">		END_OF_DATA, /**</span>
		 * Status of iterators, that peeked the next element already.
		 */
<span class="nc" id="L200">		PEEKED;</span>
	}


	/**
	 * An instance of this is passed to the elements supplier at the time of
	 * calculating the next element. It is used to mark the iteration's end. Check
	 * out {@link #endOfData()} for more information.
	 *
	 * @param &lt;E&gt; the type of the iterator elements
	 */
	@FunctionalInterface
	@SuppressWarnings(&quot;PMD.UnnecessaryModifier&quot;)
	public static interface ElementsSupplierStateHandler&lt;E&gt; {
		/**
		 * Marks the iteration's end, the so called &lt;i&gt;end of data&lt;/i&gt;.
		 *
		 * &lt;p&gt;
		 * If this has been called the return value of the elements supplier will not be
		 * taken into account.
		 *
		 * &lt;p&gt;
		 * Check out {@link #iterator(Function)} for an usage example.
		 *
		 * @return any valid value, probably {@code null}
		 */
		@Nullable
		E endOfData();
	}

	@java.lang.SuppressWarnings(&quot;all&quot;)
	@edu.umd.cs.findbugs.annotations.SuppressFBWarnings(justification = &quot;generated code&quot;)
	@lombok.Generated
	private Iterators() {
		throw new java.lang.UnsupportedOperationException(&quot;This is a utility class and cannot be instantiated&quot;);
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>