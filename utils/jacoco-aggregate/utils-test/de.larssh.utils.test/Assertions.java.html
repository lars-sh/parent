<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>Assertions.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">Utilities</a> &gt; <a href="../index.html" class="el_bundle">utils-test</a> &gt; <a href="index.source.html" class="el_package">de.larssh.utils.test</a> &gt; <span class="el_source">Assertions.java</span></div><h1>Assertions.java</h1><pre class="source lang-java linenums">// Generated by delombok at Mon Aug 24 12:04:06 UTC 2020
package de.larssh.utils.test;

import static java.util.stream.Collectors.joining;
import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.assertNotEquals;
import java.util.Arrays;
import java.util.function.Function;
import java.util.function.Supplier;
import java.util.stream.IntStream;
import org.jooq.lambda.function.Consumer3;
import org.joor.Reflect;
import edu.umd.cs.findbugs.annotations.SuppressFBWarnings;

/**
 * This class contains helper methods for assertion.
 */
public final class Assertions {
	/**
	 * Asserts that the methods {@link Object#equals(Object)} and
	 * {@link Object#hashCode()} of objects created by executing the {@code clazz}es
	 * constructor work as defined by {@code arguments}.
	 *
	 * &lt;p&gt;
	 * The constructor of {@code clazz} is called multiple times using different
	 * combinations of arguments. The resulting objects equality is checked using
	 * declarations of {@code arguments}.
	 * {@link Reflects#create(Reflect, Object...)} is used to construct instances of
	 * {@code clazz}.
	 *
	 * &lt;p&gt;
	 * {@code arguments} declares two kind of valid arguments for the class
	 * constructor and if changing the argument should change the objects equality.
	 *
	 * &lt;p&gt;
	 * In addition to argument checks {@link Object#equals(Object)} is checked
	 * against {@code null}, {@code true} and the object itself while the first two
	 * are expected to differ from the object itself.
	 *
	 * @param clazz     class to be instantiated based on given arguments
	 * @param arguments declaration of arguments and if changing arguments should
	 *                  change equality
	 */
	public static void assertEqualsAndHashCode(final Class&lt;?&gt; clazz, final AssertEqualsAndHashCodeArguments arguments) {
<span class="nc" id="L45">		final Reflect reflect = Reflect.onClass(clazz);</span>
<span class="nc" id="L46">		assertEqualsAndHashCode(a -&gt; Reflects.create(reflect, a).get(), arguments);</span>
<span class="nc" id="L47">	}</span>

	/**
	 * Asserts that the methods {@link Object#equals(Object)} and
	 * {@link Object#hashCode()} of objects created by executing {@code constructor}
	 * work as defined by {@code arguments}.
	 *
	 * &lt;p&gt;
	 * {@code constructor} is called multiple times using different combinations of
	 * arguments. The resulting objects equality is checked using declarations of
	 * {@code arguments}.
	 *
	 * &lt;p&gt;
	 * {@code arguments} declares two kind of valid arguments for the constructor
	 * and if changing the argument should change the objects equality.
	 *
	 * &lt;p&gt;
	 * In addition to argument checks {@link Object#equals(Object)} is checked
	 * against {@code null}, {@code true} and the object itself while the first two
	 * are expected to differ from the object itself.
	 *
	 * @param constructor function to construct object instances based on given
	 *                    arguments
	 * @param arguments   declaration of arguments and if changing arguments should
	 *                    change equality
	 */
	@SuppressFBWarnings(value = &quot;PRMC_POSSIBLY_REDUNDANT_METHOD_CALLS&quot;, justification = &quot;need to call constructor twice to validate equals&quot;)
	public static void assertEqualsAndHashCode(final Function&lt;Object[], ?&gt; constructor, final AssertEqualsAndHashCodeArguments arguments) {
<span class="fc" id="L75">		final Function&lt;Object[], ?&gt; wrappedConstructor = wrapConstructorExceptions(constructor);</span>
<span class="fc" id="L76">		final Object object = wrappedConstructor.apply(arguments.getOriginal().toArray());</span>
<span class="fc" id="L77">		final int hashCode = object.hashCode();</span>
<span class="fc" id="L78">		assertNotEquals(null, object, &quot;equals null&quot;);</span>
<span class="fc" id="L79">		assertNotEquals(Boolean.TRUE, object, &quot;equals true&quot;);</span>
<span class="fc" id="L80">		assertEquals(object, object, &quot;equals this&quot;);</span>
<span class="fc" id="L81">		final Object sameObject = wrappedConstructor.apply(arguments.getOriginal().toArray());</span>
<span class="fc" id="L82">		assertEquals(object, sameObject, &quot;equals original arguments&quot;);</span>
<span class="fc" id="L83">		assertEquals(hashCode, sameObject.hashCode(), &quot;hashCode original arguments&quot;);</span>
<span class="fc" id="L84">		IntStream.range(0, arguments.getOriginal().size()).forEach(index -&gt; {</span>
<span class="pc bpc" id="L85" title="1 of 2 branches missed.">			final Consumer3&lt;Object, Object, Supplier&lt;String&gt;&gt; consumer = arguments.isExpectEquality(index) ? org.junit.jupiter.api.Assertions::assertEquals : org.junit.jupiter.api.Assertions::assertNotEquals;</span>
<span class="fc" id="L86">			final Object newObject = wrappedConstructor.apply(arguments.getChangedArguments(index).toArray());</span>
			// Assert equals
<span class="pc bnc" id="L88" title="All 2 branches missed.">			final Supplier&lt;String&gt; equalsMessage = () -&gt; String.format(&quot;%sequals changed argument %d&quot;, arguments.isExpectEquality(index) ? &quot;&quot; : &quot;not &quot;, index + 1);</span>
<span class="fc" id="L89">			consumer.accept(object, newObject, equalsMessage);</span>
			// Assert hashCode
<span class="pc" id="L91">			final Supplier&lt;String&gt; hashCodeMessage = () -&gt; String.format(&quot;hashCode changed argument %d&quot;, index + 1);</span>
<span class="fc" id="L92">			consumer.accept(hashCode, newObject.hashCode(), hashCodeMessage);</span>
<span class="fc" id="L93">		});</span>
<span class="fc" id="L94">	}</span>

	/**
	 * Wraps {@code constructor} to wrap exceptions thrown by that constructor with
	 * an {@link AssertionException} showing the used arguments.
	 *
	 * @param &lt;T&gt;         the constructors class
	 * @param constructor the constructor to wrap
	 * @return wrapped constructor
	 */
	@SuppressWarnings({&quot;checkstyle:IllegalCatch&quot;, &quot;PMD.AvoidCatchingGenericException&quot;})
	@SuppressFBWarnings(value = &quot;EXS_EXCEPTION_SOFTENING_NO_CONSTRAINTS&quot;, justification = &quot;throw AssertionException instead&quot;)
	private static &lt;T&gt; Function&lt;Object[], T&gt; wrapConstructorExceptions(final Function&lt;Object[], T&gt; constructor) {
<span class="fc" id="L107">		return arguments -&gt; {</span>
			try {
<span class="fc" id="L109">				return constructor.apply(arguments);</span>
<span class="nc" id="L110">			} catch (final Exception e) {</span>
<span class="nc" id="L111">				throw new AssertionException(e, Arrays.stream(arguments).map(Object::toString).collect(joining(&quot;], [&quot;, &quot;Failed constructing using [&quot;, &quot;]&quot;)));</span>
			}
		};
	}

	@java.lang.SuppressWarnings(&quot;all&quot;)
	@edu.umd.cs.findbugs.annotations.SuppressFBWarnings(justification = &quot;generated code&quot;)
	@lombok.Generated
	private Assertions() {
		throw new java.lang.UnsupportedOperationException(&quot;This is a utility class and cannot be instantiated&quot;);
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>